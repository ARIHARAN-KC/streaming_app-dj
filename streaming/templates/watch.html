{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container mx-auto p-6 bg-white dark:bg-gray-800 rounded-lg shadow-md">
    <!-- Display the original video -->
    <div class="mb-8">
        <h3 class="text-xl font-semibold text-primary-blue dark:text-white mb-4">Original Video</h3>
        <div class="flex justify-center">
            {% if video.source == 'YouTube' %}
                <!-- Embed YouTube video -->
                <iframe 
                    width="560" height="315" 
                    src="https://www.youtube.com/embed/{{ video.video_id }}?autoplay=1" 
                    frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                    allowfullscreen
                    class="rounded-lg shadow-lg">
                </iframe>
            {% else %}
                <!-- Local video display -->
                <video class="w-full max-w-lg rounded-lg shadow-lg" controls>
                    <source src="{{ video.video_file }}" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
            {% endif %}
        </div>
    </div>

    <!-- Title and Description -->
    <div class="mb-8">
        <h2 class="text-2xl font-bold text-primary-blue dark:text-white mb-4">{{ video.title }}</h2>
        <p id="description" class="text-gray-700 dark:text-gray-300 mb-6">
            {% if video.description|length > 250 %}
                {{ video.description|slice:":250" }}...
                <a href="#" id="show-more" class="text-secondary-blue hover:text-primary-blue transition-colors duration-200">Show more</a>
            {% else %}
                {{ video.description }}
            {% endif %}
        </p>
    </div>

    <!-- Dub Video Form -->
    {% if video.video_id %}
    <form method="POST" action="{% url 'dub_video' video.video_id %}" class="mb-8 bg-neutral-gray dark:bg-gray-700 rounded-lg shadow-md p-6">
        {% csrf_token %}
        <label for="language" class="block text-lg font-medium text-primary-blue dark:text-white mb-2">Select Language to Dub:</label>
        <div class="flex items-center gap-4">
            <select name="language" id="language" required class="w-full p-2 border border-muted-blue dark:border-gray-600 rounded-md text-primary-blue dark:text-white bg-white dark:bg-gray-800 focus:ring-secondary-blue focus:border-secondary-blue">
                <option value="en">English</option>
                <option value="es">Spanish</option>
                <option value="fr">French</option>
                <option value="de">German</option>
                <option value="zh">Chinese</option>
                <option value="ta">Tamil</option>
            </select>
            <button type="submit" class="px-4 py-2 bg-primary-blue text-white rounded-lg hover:bg-secondary-blue transition-colors duration-200">
                Dub Video
            </button>
        </div>
    </form>
    {% endif %}

    <!-- Display the dubbed video if available -->
    {% if dubbed_video %}
        <div class="mb-8">
            <h3 class="text-xl font-semibold text-primary-blue dark:text-white mb-4">Dubbed Video in {{ dubbed_language }}</h3>
            <div class="flex justify-center">
                <!-- Display the local dubbed video -->
                <video class="w-full max-w-lg rounded-lg shadow-lg" controls>
                    <source src="{{ dubbed_video }}" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
            </div>
        </div>
    {% endif %}
</div>

<!-- JavaScript to toggle full description -->
<script>
    document.getElementById('show-more')?.addEventListener('click', function(event) {
        event.preventDefault();
        var description = document.getElementById('description');
        description.textContent = "{{ video.description }}";
        this.style.display = 'none';
    });
</script>
{% endblock %}